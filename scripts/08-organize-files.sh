#!/bin/bash
#
# ============================================================================
# 脚本名称: 08-organize-files.sh
# 功能描述: 整理固件文件
# ============================================================================
# 作用:
#   1. 进入固件输出目录
#   2. 删除 packages 目录（只保留固件文件，节省空间）
#   3. 输出固件文件路径
# ============================================================================
# 输出:
#   - FIRMWARE_DIR: 固件文件所在目录的绝对路径
# ============================================================================
#

set -e  # 遇到错误立即退出

echo "========================================="
echo "📦 整理固件文件..."
echo "========================================="

# 进入固件输出目录（路径格式：bin/targets/架构/型号/）
cd openwrt/bin/targets/*/*

echo "[1/2] 当前固件目录: $PWD"

# 删除 packages 目录（只保留固件文件，节省空间）
echo "[2/2] 删除 packages 目录（节省空间）..."
rm -rf packages

# 输出固件文件列表
echo ""
echo "========================================="
echo "固件文件列表:"
echo "========================================="
ls -lh

# 将当前目录路径输出到环境变量（供 GitHub Actions 使用）
echo "FIRMWARE_DIR=$PWD"

echo ""
echo "✅ 固件整理完成！"

